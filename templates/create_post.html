{% extends "base.html" %}

{% block title %}å‘å¸ƒå¯»å® ä¿¡æ¯ - å® ç‰©ä¸¢å¤±ç½‘ç«™{% endblock %}

{% block content %}
<div class="card" style="max-width: 800px; margin: 2rem auto;">
    <div class="card-header">
        <h2>ğŸ¾ å‘å¸ƒå¯»å® ä¿¡æ¯</h2>
        <p style="margin: 0.5rem 0 0 0; color: #666;">è¯·è¯¦ç»†å¡«å†™å® ç‰©ä¿¡æ¯ï¼Œå¸®åŠ©æ›´å¤šäººå…³æ³¨å’Œå¯»æ‰¾</p>
    </div>
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data" onsubmit="return validatePostForm()" id="post-form">
            <div class="form-group">
                <label for="title">æ ‡é¢˜ *</label>
                <input type="text" class="form-control" id="title" name="title" required 
                       placeholder="ä¾‹å¦‚ï¼šå¯»æ‰¾èµ°å¤±çš„é‡‘æ¯›çŠ¬"è±†è±†"" maxlength="100">
                <small style="color: #666;">ç®€æ´æ˜äº†çš„æ ‡é¢˜æœ‰åŠ©äºå¸å¼•æ›´å¤šå…³æ³¨</small>
            </div>
            
            <div class="form-group">
                <label for="pet_type">å® ç‰©ç±»å‹ *</label>
                <select class="form-control" id="pet_type" name="pet_type" required>
                    <option value="">è¯·é€‰æ‹©å® ç‰©ç±»å‹</option>
                    <option value="ç‹—">ç‹—ç‹—</option>
                    <option value="çŒ«">çŒ«å’ª</option>
                    <option value="é¸Ÿ">é¸Ÿç±»</option>
                    <option value="å…”å­">å…”å­</option>
                    <option value="ä»“é¼ ">ä»“é¼ </option>
                    <option value="å…¶ä»–">å…¶ä»–</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="lost_location">ä¸¢å¤±åœ°ç‚¹ *</label>
                <input type="text" class="form-control" id="lost_location" name="lost_location" required 
                       placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒºæœ›äº¬SOHOé™„è¿‘" maxlength="200">
                <small style="color: #666;">è¯·å°½é‡è¯¦ç»†æè¿°ä¸¢å¤±çš„å…·ä½“ä½ç½®</small>
            </div>
            
            <div class="form-group">
                <label for="description">è¯¦ç»†æè¿° *</label>
                <textarea class="form-control" id="description" name="description" required 
                          placeholder="è¯·è¯¦ç»†æè¿°å® ç‰©çš„å¤–è§‚ç‰¹å¾ã€æ€§æ ¼ã€ä¸¢å¤±æ—¶é—´ã€å½“æ—¶æƒ…å†µç­‰ä¿¡æ¯..." 
                          rows="6" maxlength="2000"></textarea>
                <small style="color: #666;">è¯¦ç»†çš„æè¿°æœ‰åŠ©äºä»–äººè¯†åˆ«å’Œæä¾›çº¿ç´¢</small>
            </div>
            
            <div class="form-group">
                <label for="contact_info">è”ç³»æ–¹å¼ *</label>
                <input type="text" class="form-control" id="contact_info" name="contact_info" required 
                       placeholder="è¯·ç•™ä¸‹æ‚¨çš„è”ç³»æ–¹å¼ï¼ˆæ‰‹æœºå·ã€å¾®ä¿¡ç­‰ï¼‰" maxlength="100">
                <small style="color: #666;">æ–¹ä¾¿å¥½å¿ƒäººè”ç³»æ‚¨æä¾›çº¿ç´¢</small>
            </div>
            
            <div class="form-group">
                <label for="images">å® ç‰©ç…§ç‰‡ï¼ˆæœ€å¤š9å¼ ï¼‰</label>
                <div class="file-upload">
                    <input type="file" id="images" name="images" multiple accept="image/*">
                    <label for="images" class="file-upload-label">
                        <div style="font-size: 2rem; margin-bottom: 0.5rem;">ğŸ“·</div>
                        <div>ç‚¹å‡»é€‰æ‹©å›¾ç‰‡æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°æ­¤å¤„</div>
                        <div style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">
                            æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œæœ€å¤š9å¼ å›¾ç‰‡
                        </div>
                    </label>
                </div>
                
                <div id="image-preview" class="image-grid" style="margin-top: 1rem;"></div>
            </div>
            
            <div style="background-color: #e8f4fd; padding: 1rem; border-radius: 8px; margin: 1.5rem 0;">
                <h4 style="color: #2c3e50; margin-bottom: 0.5rem;">ğŸ’¡ å‘å¸ƒå°è´´å£«</h4>
                <ul style="color: #555; margin: 0; padding-left: 1.5rem;">
                    <li>ä¸Šä¼ æ¸…æ™°çš„å® ç‰©ç…§ç‰‡ï¼ŒåŒ…æ‹¬æ­£é¢ã€ä¾§é¢ç­‰ä¸åŒè§’åº¦</li>
                    <li>è¯¦ç»†æè¿°å® ç‰©çš„å“ç§ã€é¢œè‰²ã€å¤§å°ã€ç‰¹æ®Šæ ‡è®°ç­‰ç‰¹å¾</li>
                    <li>è¯´æ˜ä¸¢å¤±çš„å…·ä½“æ—¶é—´å’Œåœ°ç‚¹</li>
                    <li>ç•™ä¸‹å‡†ç¡®çš„è”ç³»æ–¹å¼ï¼Œæ–¹ä¾¿å¥½å¿ƒäººè”ç³»</li>
                </ul>
            </div>
            
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                <a href="{{ url_for('index') }}" class="btn" style="background-color: #95a5a6; color: white;">
                    å–æ¶ˆ
                </a>
                <button type="submit" class="btn btn-primary">
                    å‘å¸ƒä¿¡æ¯
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>

// è¡¨å•éªŒè¯
function validatePostForm() {
    const title = document.getElementById('title').value.trim();
    const petType = document.getElementById('pet_type').value;
    const lostLocation = document.getElementById('lost_location').value.trim();
    const description = document.getElementById('description').value.trim();
    const contactInfo = document.getElementById('contact_info').value.trim();
    
    if (!title) {
        showAlert('è¯·å¡«å†™æ ‡é¢˜', 'danger');
        document.getElementById('title').focus();
        return false;
    }
    
    if (!petType) {
        showAlert('è¯·é€‰æ‹©å® ç‰©ç±»å‹', 'danger');
        document.getElementById('pet_type').focus();
        return false;
    }
    
    if (!lostLocation) {
        showAlert('è¯·å¡«å†™ä¸¢å¤±åœ°ç‚¹', 'danger');
        document.getElementById('lost_location').focus();
        return false;
    }
    
    if (!description || description.length < 10) {
        showAlert('è¯·è¯¦ç»†æè¿°å® ç‰©ä¿¡æ¯ï¼ˆè‡³å°‘10ä¸ªå­—ç¬¦ï¼‰', 'danger');
        document.getElementById('description').focus();
        return false;
    }
    
    if (!contactInfo) {
        showAlert('è¯·å¡«å†™è”ç³»æ–¹å¼', 'danger');
        document.getElementById('contact_info').focus();
        return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦ä¸Šä¼ äº†å›¾ç‰‡
    const files = document.getElementById('images').files;
    if (files.length === 0) {
        const confirm = window.confirm('æ‚¨è¿˜æ²¡æœ‰ä¸Šä¼ å® ç‰©ç…§ç‰‡ï¼Œç…§ç‰‡æœ‰åŠ©äºä»–äººè¯†åˆ«ã€‚ç¡®å®šè¦ç»§ç»­å‘å¸ƒå—ï¼Ÿ');
        if (!confirm) {
            return false;
        }
    }
    
    return true;
}

// æ‹–æ‹½ä¸Šä¼ åŠŸèƒ½
const fileUpload = document.querySelector('.file-upload');
const fileInput = document.getElementById('images');

fileUpload.addEventListener('dragover', function(e) {
    e.preventDefault();
    this.style.backgroundColor = '#e3f2fd';
    this.style.borderColor = '#3498db';
});

fileUpload.addEventListener('dragleave', function(e) {
    e.preventDefault();
    this.style.backgroundColor = '#f8f9fa';
    this.style.borderColor = '#ddd';
});

fileUpload.addEventListener('drop', function(e) {
    e.preventDefault();
    this.style.backgroundColor = '#f8f9fa';
    this.style.borderColor = '#ddd';
    
    const files = e.dataTransfer.files;
    fileInput.files = files;
    
    // è§¦å‘changeäº‹ä»¶ï¼Œè®©main.jsä¸­çš„å¤„ç†å‡½æ•°æ¥ç®¡
    const event = new Event('change', { bubbles: true });
    fileInput.dispatchEvent(event);
});
</script>
{% endblock %}