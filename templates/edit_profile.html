{% extends "base.html" %}

{% block title %}ç¼–è¾‘ä¸ªäººèµ„æ–™ - å® ç‰©ä¸¢å¤±ç½‘ç«™{% endblock %}

{% block content %}
<div class="card" style="margin-bottom: 2rem;">
    <div class="card-header">
        <div style="display: flex; justify-content: space-between; align-items: center;">
            <h2 style="margin: 0;">âœï¸ ç¼–è¾‘ä¸ªäººèµ„æ–™</h2>
            <a href="{{ url_for('profile') }}" class="btn btn-secondary">
                â† è¿”å›èµ„æ–™é¡µ
            </a>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="POST" enctype="multipart/form-data" id="profileForm">
            <div style="display: grid; grid-template-columns: 300px 1fr; gap: 2rem; align-items: start;">
                <!-- å¤´åƒä¸Šä¼ åŒºåŸŸ -->
                <div style="text-align: center;">
                    <div style="margin-bottom: 1rem;">
                        <label style="font-weight: bold; color: #555; display: block; margin-bottom: 0.5rem;">ğŸ“· å¤´åƒ</label>
                        <div id="avatarPreview" style="margin-bottom: 1rem;">
                            {% if user.avatar %}
                                <img src="{{ url_for('static', filename='uploads/' + user.avatar) }}" 
                                     alt="å½“å‰å¤´åƒ" 
                                     style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #3498db;">
                            {% else %}
                                <div style="width: 150px; height: 150px; border-radius: 50%; background-color: #3498db; 
                                            display: flex; align-items: center; justify-content: center; color: white; 
                                            font-size: 3rem; margin: 0 auto;">
                                    {{ user.username[0].upper() }}
                                </div>
                            {% endif %}
                        </div>
                        <input type="file" id="avatar" name="avatar" accept="image/*" 
                               style="display: none;" onchange="previewAvatar(this)">
                        <button type="button" class="btn btn-outline-primary" onclick="document.getElementById('avatar').click()">
                            ğŸ“ é€‰æ‹©å¤´åƒ
                        </button>
                        <p style="font-size: 0.9rem; color: #666; margin-top: 0.5rem;">æ”¯æŒ JPGã€PNG æ ¼å¼</p>
                    </div>
                </div>
                
                <!-- åŸºæœ¬ä¿¡æ¯è¡¨å• -->
                <div>
                    <h4 style="color: #2c3e50; margin-bottom: 1.5rem; border-bottom: 2px solid #3498db; padding-bottom: 0.5rem;">ğŸ“‹ åŸºæœ¬ä¿¡æ¯</h4>
                    
                    <div style="display: grid; gap: 1.5rem;">
                        <div class="form-group">
                            <label for="real_name" style="font-weight: bold; color: #555; display: block; margin-bottom: 0.5rem;">ğŸ‘¤ çœŸå®å§“å</label>
                            <input type="text" id="real_name" name="real_name" 
                                   value="{{ user.real_name or '' }}" 
                                   placeholder="è¯·è¾“å…¥æ‚¨çš„çœŸå®å§“å"
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem;">
                        </div>
                        
                        <div class="form-group">
                            <label for="phone" style="font-weight: bold; color: #555; display: block; margin-bottom: 0.5rem;">ğŸ“± æ‰‹æœºå·ç </label>
                            <input type="tel" id="phone" name="phone" 
                                   value="{{ user.phone or '' }}" 
                                   placeholder="è¯·è¾“å…¥æ‚¨çš„æ‰‹æœºå·ç "
                                   pattern="[0-9]{11}"
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem;">
                            <small style="color: #666; font-size: 0.9rem;">è¯·è¾“å…¥11ä½æ‰‹æœºå·ç </small>
                        </div>
                        
                        <div class="form-group">
                            <label for="location" style="font-weight: bold; color: #555; display: block; margin-bottom: 0.5rem;">ğŸ“ æ‰€åœ¨åœ°åŒº</label>
                            <input type="text" id="location" name="location" 
                                   value="{{ user.location or '' }}" 
                                   placeholder="å¦‚ï¼šåŒ—äº¬å¸‚æœé˜³åŒº"
                                   style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem;">
                        </div>
                        
                        <div class="form-group">
                            <label for="bio" style="font-weight: bold; color: #555; display: block; margin-bottom: 0.5rem;">ğŸ“ ä¸ªäººç®€ä»‹</label>
                            <textarea id="bio" name="bio" rows="4" 
                                      placeholder="ä»‹ç»ä¸€ä¸‹è‡ªå·±å§..."
                                      style="width: 100%; padding: 0.75rem; border: 2px solid #ddd; border-radius: 5px; font-size: 1rem; resize: vertical;">{{ user.bio or '' }}</textarea>
                            <small style="color: #666; font-size: 0.9rem;">æœ€å¤š200ä¸ªå­—ç¬¦</small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æäº¤æŒ‰é’® -->
            <div style="margin-top: 2rem; text-align: center; padding-top: 2rem; border-top: 1px solid #eee;">
                <button type="submit" class="btn btn-primary" style="padding: 0.75rem 2rem; font-size: 1.1rem;">
                    ğŸ’¾ ä¿å­˜èµ„æ–™
                </button>
                <a href="{{ url_for('profile') }}" class="btn btn-secondary" style="margin-left: 1rem; padding: 0.75rem 2rem; font-size: 1.1rem;">
                    âŒ å–æ¶ˆ
                </a>
            </div>
        </form>
    </div>
</div>

<!-- JavaScript -->
<script>
function previewAvatar(input) {
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('avatarPreview');
            preview.innerHTML = `
                <img src="${e.target.result}" 
                     alt="å¤´åƒé¢„è§ˆ" 
                     style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid #3498db;">
            `;
        };
        reader.readAsDataURL(input.files[0]);
    }
}

// è¡¨å•éªŒè¯
document.getElementById('profileForm').addEventListener('submit', function(e) {
    const phone = document.getElementById('phone').value;
    const bio = document.getElementById('bio').value;
    
    // éªŒè¯æ‰‹æœºå·æ ¼å¼
    if (phone && !/^[0-9]{11}$/.test(phone)) {
        alert('è¯·è¾“å…¥æ­£ç¡®çš„11ä½æ‰‹æœºå·ç ');
        e.preventDefault();
        return;
    }
    
    // éªŒè¯ç®€ä»‹é•¿åº¦
    if (bio.length > 200) {
        alert('ä¸ªäººç®€ä»‹ä¸èƒ½è¶…è¿‡200ä¸ªå­—ç¬¦');
        e.preventDefault();
        return;
    }
});
</script>

<!-- å“åº”å¼æ ·å¼ -->
<style>
@media (max-width: 768px) {
    .card-body form > div:first-child {
        grid-template-columns: 1fr !important;
        text-align: center;
    }
    
    .form-group {
        margin-bottom: 1rem;
    }
}

.form-group input:focus,
.form-group textarea:focus {
    border-color: #3498db;
    outline: none;
    box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
}

.btn {
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
</style>
{% endblock %}